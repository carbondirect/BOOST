{
  "schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://github.com/carbondirect/BOOST/schemas/product-group",
    "type": "object",
    "properties": {
      "@context": {
        "type": "object"
      },
      "@type": {
        "type": "string",
        "enum": ["ProductGroup"]
      },
      "@id": {
        "type": "string",
        "format": "uri"
      },
      "productGroupId": {
        "type": "string"
      },
      "productTypeDescription": {
        "type": "string"
      },
      "feedstockClassificationRules": {
        "type": "string"
      },
      "lastUpdated": {
        "type": "string",
        "format": "date-time"
      },
      "relatedTransactionConsignments": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "@type": { "const": "TransactionConsignment" },
            "id": { "type": "string" }
          },
          "required": ["@type", "id"]
        }
      },
      "relatedMaterialFeedstocks": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "@type": { "const": "MaterialFeedstock" },
            "id": { "type": "string" }
          },
          "required": ["@type", "id"]
        }
      },
      "relatedCertificates": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "@type": { "const": "Certificate" },
            "id": { "type": "string" }
          },
          "required": ["@type", "id"]
        }
      }
    },
    "required": ["@context", "@type", "@id", "productGroupId", "productTypeDescription", "feedstockClassificationRules"]
  },
  "rules": {
    "and": [
      {
        "!!": { "var": "productGroupId" }
      },
      {
        "!!": { "var": "productTypeDescription" }
      },
      {
        "!!": { "var": "feedstockClassificationRules" }
      },
      {
        "if": [
          {
            "in": [
              { "var": "productTypeDescription" },
              [
                "Pelletized Biofuel from Forest Slash",
                "Engineered Hardwood Flooring",
                "Bagasse Pellets",
                "Biochar",
                "Renewable Diesel",
                "Biogenic Fuel Oil"
              ]
            ]
          },
          {
            "!!": { "var": "feedstockClassificationRules" }
          },
          true
        ]
      },
      {
        "if": [
          { "var": "relatedCertificates" },
          {
            "and": [
              { ">": [ { "var": "relatedCertificates.length" }, 0 ] },
              { "all": [
                { "var": "relatedCertificates" },
                {
                  "and": [
                    { "!!": { "var": "id" } },
                    { "==": [ { "var": "@type" }, "Certificate" ] }
                  ]
                }
              ]}
            ]
          },
          true
        ]
      },
      {
        "if": [
          { "var": "relatedTransactionConsignments" },
          {
            "all": [
              { "var": "relatedTransactionConsignments" },
              {
                "and": [
                  { "!!": { "var": "id" } },
                  { "==": [ { "var": "@type" }, "TransactionConsignment" ] }
                ]
              }
            ]
          },
          true
        ]
      },
      {
        "if": [
          { "var": "relatedMaterialFeedstocks" },
          {
            "all": [
              { "var": "relatedMaterialFeedstocks" },
              {
                "and": [
                  { "!!": { "var": "id" } },
                  { "==": [ { "var": "@type" }, "MaterialFeedstock" ] }
                ]
              }
            ]
          },
          true
        ]
      }
    ]
  }
}
  