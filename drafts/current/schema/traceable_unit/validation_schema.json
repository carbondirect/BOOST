{
  "schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://github.com/carbondirect/BOOST/schemas/traceable-unit",
    "title": "Traceable Unit",
    "description": "Unique biomass tracking unit with BOOST traceability system integration",
    "type": "object",
    "properties": {
      "@context": {
        "type": "object",
        "description": "JSON-LD context defining semantic vocabulary mappings"
      },
      "@type": {
        "type": "string",
        "enum": [
          "TraceableUnit"
        ],
        "description": "Entity type identifier for JSON-LD processing"
      },
      "@id": {
        "type": "string",
        "format": "uri",
        "description": "Globally unique IRI identifying this specific entity instance"
      },
      "traceableUnitId": {
        "type": "string",
        "pattern": "^TRU-[A-Z0-9-_]+$",
        "description": "Unique ID for each TRU"
      },
      "unitType": {
        "type": "string",
        "enum": [
          "individual_log",
          "pile",
          "volume_aggregation",
          "processed_batch"
        ],
        "description": "Type of traceable unit"
      },
      "uniqueIdentifier": {
        "type": "string",
        "description": "Biometric signature, RFID tag, or QR code"
      },
      "totalVolumeM3": {
        "type": "number",
        "minimum": 0,
        "description": "Total volume of the traceable unit in cubic meters"
      },
      "currentGeographicDataId": {
        "type": "string",
        "pattern": "^GEO-[A-Z0-9-_]+$",
        "description": "Current location - uses EntityNameId convention referencing GeographicData"
      },
      "harvestGeographicDataId": {
        "type": "string",
        "pattern": "^GEO-[A-Z0-9-_]+$",
        "description": "Harvest location - uses EntityNameId convention referencing GeographicData"
      },
      "createdTimestamp": {
        "type": "string",
        "format": "date-time",
        "description": "When the TRU was created"
      },
      "harvesterId": {
        "type": "string",
        "description": "Foreign key to harvesting organization",
        "pattern": "^ORG-[A-Z0-9-_]+$"
      },
      "operatorId": {
        "type": "string",
        "pattern": "^OP-[A-Z0-9-_]+$",
        "description": "Foreign key to operator"
      },
      "materialTypeId": {
        "type": "string",
        "pattern": "^MAT-[A-Z0-9-_]+$",
        "description": "Foreign key to Material entity (reference table)"
      },
      "assortmentType": {
        "type": "string",
        "enum": [
          "sawlog",
          "pulpwood",
          "biomass",
          "chips"
        ],
        "description": "Type of wood assortment"
      },
      "qualityGrade": {
        "type": "string",
        "enum": [
          "A",
          "B",
          "C",
          "structural",
          "fuel"
        ],
        "description": "Quality grade classification"
      },
      "isMultiSpecies": {
        "type": "boolean",
        "description": "True if contains multiple species"
      },
      "attachedInformation": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "All data linked to this TRU"
      },
      "processingHistory": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "Complete processing chain references (Phase 2)"
      },
      "parentTraceableUnitId": {
        "type": "string",
        "description": "For split/merge operations (Phase 2)"
      },
      "childTraceableUnitIds": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "For split/merge operations (Phase 2)"
      },
      "currentStatus": {
        "type": "string",
        "enum": [
          "active",
          "processed",
          "delivered",
          "consumed"
        ],
        "description": "Current status of the TRU (Phase 2)"
      },
      "sustainabilityCertification": {
        "type": "string",
        "description": "FSC, PEFC, etc. claims (Phase 2)"
      },
      "mediaBreakFlags": {
        "type": "array",
        "items": {
          "type": "string"
        },
        "description": "Points where data continuity was lost (Phase 2)"
      },
      "lastUpdated": {
        "type": "string",
        "format": "date-time",
        "description": "Timestamp of the most recent data update"
      }
    },
    "required": [
      "@context",
      "@type",
      "@id",
      "traceableUnitId",
      "unitType",
      "uniqueIdentifier",
      "totalVolumeM3",
      "createdTimestamp",
      "harvesterId",
      "materialTypeId",
      "isMultiSpecies",
      "harvestGeographicDataId"
    ]
  },
  "rules": {
    "and": [
      {
        "!!": {
          "var": "traceableUnitId"
        }
      },
      {
        "!!": {
          "var": "unitType"
        }
      },
      {
        "!!": {
          "var": "uniqueIdentifier"
        }
      },
      {
        "!!": {
          "var": "totalVolumeM3"
        }
      },
      {
        ">": [
          {
            "var": "totalVolumeM3"
          },
          0
        ]
      },
      {
        "!!": {
          "var": "createdTimestamp"
        }
      },
      {
        "!!": {
          "var": "harvesterId"
        }
      },
      {
        "!!": {
          "var": "materialTypeId"
        }
      },
      {
        "if": [
          {
            "var": "isMultiSpecies"
          },
          {
            "!!": {
              "var": "currentGeographicDataId"
            }
          },
          true
        ]
      },
      {
        "if": [
          {
            "var": "processingHistory"
          },
          {
            ">": [
              {
                "var": "processingHistory.length"
              },
              0
            ]
          },
          true
        ]
      },
      {
        "if": [
          {
            "var": "childTraceableUnitIds"
          },
          {
            ">": [
              {
                "var": "childTraceableUnitIds.length"
              },
              0
            ]
          },
          true
        ]
      }
    ]
  },
  "boost_metadata": {
    "entity": {
      "name": "TraceableUnit",
      "primaryKey": "traceableUnitId",
      "area": "core_traceability",
      "description": "CENTRAL: Unique biomass tracking unit with BOOST traceability system integration"
    },
    "relationships": [
      {
        "field": "currentGeographicDataId",
        "targetEntity": "GeographicData",
        "relationshipType": "many-to-one",
        "required": false,
        "label": "currently located at",
        "example": "TRU-456 is currently located at 'Portland Mill Yard'"
      },
      {
        "field": "harvestGeographicDataId", 
        "targetEntity": "GeographicData",
        "relationshipType": "many-to-one",
        "required": true,
        "label": "harvested at",
        "example": "TRU-123 was harvested at 'Olympic Forest Block 7A'"
      },
      {
        "field": "harvesterId",
        "targetEntity": "Organization", 
        "relationshipType": "many-to-one",
        "required": true,
        "label": "harvested by",
        "example": "TRU-123 was harvested by 'West Coast Timber Co.'"
      },
      {
        "field": "operatorId",
        "targetEntity": "Operator",
        "relationshipType": "many-to-one", 
        "required": false,
        "label": "operated by",
        "example": "TRU-789 was created by operator 'John Smith'"
      },
      {
        "field": "materialTypeId",
        "targetEntity": "Material",
        "relationshipType": "many-to-one",
        "required": true,
        "label": "material type",
        "example": "TRU-001 is classified as 'Douglas Fir Sawlog'"
      },
      {
        "field": "parentTraceableUnitId",
        "targetEntity": "TraceableUnit",
        "relationshipType": "many-to-one",
        "required": false,
        "label": "derived from",
        "example": "TRU-890 was derived from parent unit TRU-456"
      }
    ]
  }
}