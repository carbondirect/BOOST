{
  "schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://github.com/carbondirect/BOOST/schemas/transaction-batch",
    "type": "object",
    "properties": {
      "@context": {
        "type": "object"
      },
      "@type": {
        "type": "string",
        "enum": [
          "TransactionBatch"
        ]
      },
      "@id": {
        "type": "string",
        "format": "uri"
      },
      "transactionBatchId": {
        "type": "string",
        "pattern": "^TB-[A-Z0-9-_]+$",
        "description": "Unique identifier for the physical material batch"
      },
      "transactionId": {
        "type": "string",
        "pattern": "^TXN-[A-Z0-9-_]+$",
        "description": "Foreign key to parent business transaction"
      },
      "productionBatchId": {
        "type": [
          "string",
          "null"
        ],
        "pattern": "^TB-[A-Z0-9-_]+$",
        "description": "Foreign key to source production batch"
      },
      "quantity": {
        "type": "number",
        "minimum": 0,
        "description": "Physical quantity of material in this batch"
      },
      "quantityUnit": {
        "type": "string",
        "enum": [
          "cubic_meters",
          "metric_tons",
          "board_feet",
          "cord",
          "stere",
          "green_tons",
          "dry_tons"
        ],
        "description": "Unit of measurement for quantity"
      },
      "traceableUnitIds": {
        "type": "array",
        "items": {
          "type": "string",
          "pattern": "^TRU-[A-Z0-9-_]+$"
        },
        "minItems": 1,
        "description": "Array of TRU IDs included in this batch"
      },
      "claimId": {
        "type": [
          "string",
          "null"
        ],
        "pattern": "^CLA-[A-Z0-9-_]+$",
        "description": "Foreign key to primary sustainability claim"
      },
      "additionalClaimIds": {
        "type": "array",
        "items": {
          "type": "string",
          "pattern": "^CLA-[A-Z0-9-_]+$"
        },
        "description": "Array of secondary claim IDs"
      },
      "speciesComposition": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "species": {
              "type": "string"
            },
            "percentage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "volume": {
              "type": "number",
              "minimum": 0
            }
          },
          "required": [
            "species",
            "percentage"
          ]
        },
        "description": "Species breakdown with percentages"
      },
      "qualityGrade": {
        "type": "string",
        "enum": [
          "Grade-A",
          "Grade-B",
          "Grade-C",
          "Grade-D",
          "Premium",
          "Standard",
          "Economy",
          "Utility",
          "Structural",
          "Non-structural",
          "Fuel",
          "Residue",
          "Export",
          "Domestic",
          "Sawlog",
          "Pulpwood",
          "Biomass"
        ],
        "description": "Quality grade with comprehensive standard classification"
      },
      "processingHistoryIds": {
        "type": "array",
        "items": {
          "type": "string",
          "pattern": "^PH-[A-Z0-9-_]+$"
        },
        "description": "Array of processing history record IDs"
      },
      "reconciliationStatus": {
        "type": "string",
        "enum": [
          "pending",
          "resolved",
          "disputed",
          "investigating"
        ],
        "description": "Reconciliation status with standard values"
      },
      "trackingHistory": {
        "type": "string",
        "description": "Complete location trail summary"
      },
      "measurementRecordIds": {
        "type": "array",
        "items": {
          "type": "string",
          "pattern": "^MR-[A-Z0-9-_]+$"
        },
        "description": "Array of measurement record IDs"
      },
      "mediaBreakDetected": {
        "type": "boolean",
        "description": "Flag indicating if traceability continuity was broken"
      },
      "batchStatus": {
        "type": "string",
        "enum": [
          "prepared",
          "in_transit",
          "delivered",
          "accepted",
          "rejected",
          "partially_delivered"
        ],
        "description": "Current status of the physical batch"
      },
      "batchCreatedDate": {
        "type": "string",
        "format": "date-time",
        "description": "When the batch was prepared/created"
      },
      "deliveryDate": {
        "type": [
          "string",
          "null"
        ],
        "format": "date-time",
        "description": "Actual delivery timestamp"
      },
      "deliveryGeographicDataId": {
        "type": [
          "string",
          "null"
        ],
        "pattern": "^GEO-[A-Z0-9-_]+$",
        "description": "Foreign key to delivery location"
      },
      "qualityMetrics": {
        "type": "object",
        "properties": {
          "moistureContent": {
            "type": "number",
            "minimum": 0,
            "maximum": 100
          },
          "density": {
            "type": "number",
            "minimum": 0
          },
          "defectRate": {
            "type": "number",
            "minimum": 0,
            "maximum": 100
          },
          "contaminationLevel": {
            "type": "string",
            "enum": [
              "none",
              "minimal",
              "moderate",
              "significant",
              "unacceptable"
            ]
          },
          "gradingMethod": {
            "type": "string",
            "enum": [
              "visual",
              "mechanical",
              "optical",
              "combination"
            ]
          },
          "qualityAssessmentDate": {
            "type": "string",
            "format": "date-time"
          },
          "assessorId": {
            "type": "string"
          }
        },
        "description": "Detailed quality assessment metrics"
      },
      "plantPartComposition": {
        "type": "object",
        "patternProperties": {
          "^(trunk|branches|twigs|bark|heartwood|sapwood|leaves|needles|seeds|nuts|cones|stalks|straw|husks|hulls|chaff|stubble)$": {
            "type": "object",
            "properties": {
              "volume": {
                "type": "number",
                "minimum": 0
              },
              "percentage": {
                "type": "number",
                "minimum": 0,
                "maximum": 100
              }
            },
            "required": [
              "volume",
              "percentage"
            ]
          }
        },
        "description": "Plant part composition breakdown"
      },
      "transportationData": {
        "type": "object",
        "properties": {
          "carrierOrganizationId": {
            "type": "string"
          },
          "transportMethod": {
            "type": "string",
            "enum": [
              "truck",
              "rail",
              "ship",
              "barge",
              "conveyor",
              "pipeline"
            ]
          },
          "vehicleId": {
            "type": "string"
          },
          "driverOperatorId": {
            "type": "string"
          },
          "pickupDate": {
            "type": "string",
            "format": "date-time"
          },
          "estimatedArrival": {
            "type": "string",
            "format": "date-time"
          },
          "routeOptimization": {
            "type": "string",
            "enum": [
              "shortest_distance",
              "fastest_time",
              "fuel_efficient",
              "regulatory_compliant"
            ]
          }
        },
        "description": "Transportation and logistics information"
      },
      "certificationValidation": {
        "type": "object",
        "properties": {
          "certificateIds": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^CERT-[A-Z0-9-_]+$"
            }
          },
          "validationRequired": {
            "type": "boolean"
          },
          "validationCompleted": {
            "type": "boolean"
          },
          "validationDate": {
            "type": "string",
            "format": "date-time"
          },
          "validatorId": {
            "type": "string"
          },
          "validationNotes": {
            "type": "string"
          }
        },
        "description": "Certification and compliance validation data"
      },
      "lastUpdated": {
        "type": "string",
        "format": "date-time",
        "description": "Timestamp of last modification"
      }
    },
    "required": [
      "@context",
      "@type",
      "@id",
      "transactionBatchId",
      "transactionId",
      "quantity",
      "quantityUnit",
      "traceableUnitIds",
      "batchStatus"
    ],
    "title": "Transaction Batch",
    "description": "TransactionBatch entity in BOOST data model"
  },
  "boost_metadata": {
    "entity": {
      "name": "TransactionBatch",
      "primaryKey": "transactionBatchId",
      "area": "transaction_management",
      "description": "Physical material batches within business transactions"
    },
    "relationships": [
      {
        "field": "transactionId",
        "targetEntity": "Transaction",
        "relationshipType": "many-to-one",
        "required": true,
        "label": "part of",
        "example": "Batch TB-2024-067 is part of transaction TXN-2024-001"
      },
      {
        "field": "traceableUnitIds",
        "targetEntity": "TraceableUnit",
        "relationshipType": "many-to-many",
        "required": true,
        "label": "contains units",
        "example": "Batch TB-2024-067 contains TRU-456 + TRU-789 + TRU-890"
      },
      {
        "field": "deliveryGeographicDataId",
        "targetEntity": "GeographicData",
        "relationshipType": "many-to-one",
        "required": false,
        "label": "delivered to",
        "example": "Batch TB-2024-067 delivered to 'Portland Mill Yard'"
      }
    ]
  }
}