<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOOST Entity Schema Navigator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f6f8fa;
            color: #24292e;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 20px;
        }
        .header h1 {
            margin: 0 0 10px 0;
            color: #0366d6;
        }
        .header p {
            margin: 0;
            color: #586069;
            font-size: 16px;
        }
        .instructions {
            background-color: #f1f8ff;
            border: 1px solid #c8e1ff;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 30px;
        }
        .instructions h3 {
            margin-top: 0;
            color: #0366d6;
        }
        .erd-container {
            text-align: center;
            background-color: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 20px;
            overflow: hidden;
            position: relative;
            height: 600px;
            min-height: 400px;
        }
        .svg-wrapper {
            width: 100%;
            height: 100%;
            cursor: grab;
            transition: transform 0.1s ease;
            transform-origin: 0 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .svg-wrapper:active {
            cursor: grabbing;
        }
        .erd-svg {
            max-width: none;
            height: auto;
            pointer-events: none;
            user-select: none;
        }
        .entity-overlay {
            cursor: pointer;
            background-color: rgba(0, 123, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 4px;
            transition: all 0.2s ease;
            z-index: 5;
        }
        .entity-overlay:hover {
            background-color: rgba(0, 123, 255, 0.2);
            border-color: rgba(0, 123, 255, 0.6);
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }
        .entity-overlay::after {
            content: attr(data-entity);
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 10;
        }
        .entity-overlay:hover::after {
            opacity: 1;
        }
        .zoom-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            padding: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 10;
        }
        .zoom-btn {
            background: #f6f8fa;
            border: 1px solid #d1d5da;
            border-radius: 4px;
            padding: 6px 12px;
            margin: 2px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #24292e;
            display: inline-block;
            min-width: 32px;
            text-align: center;
        }
        .zoom-btn:hover {
            background: #e1e4e8;
            border-color: #c8e1ff;
        }
        .zoom-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            color: #586069;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .entity-box {
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .entity-box:hover {
            opacity: 0.8;
        }
        .entity-links {
            margin-top: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        .entity-link {
            display: block;
            padding: 12px 16px;
            background-color: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            text-decoration: none;
            color: #24292e;
            transition: all 0.2s;
        }
        .entity-link:hover {
            background-color: #e1e4e8;
            border-color: #c8e1ff;
            text-decoration: none;
        }
        .entity-link strong {
            color: #0366d6;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        .footer {
            margin-top: 40px;
            text-align: center;
            color: #586069;
            font-size: 14px;
            border-top: 1px solid #e1e4e8;
            padding-top: 20px;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #0366d6;
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../" class="back-link">‚Üê Back to BOOST Specification</a>
        
        <div class="header">
            <h1>üóÇÔ∏è BOOST Entity Schema Navigator</h1>
            <p>Interactive Entity Relationship Diagram for Stakeholder Feedback</p>
        </div>

        <div class="instructions">
            <h3>üìã How to Provide Feedback</h3>
            <p><strong>Click on any entity</strong> in the diagram below or use the links to jump directly to its discussion thread. No GitHub account or technical knowledge required - just share your thoughts on each entity schema!</p>
            <p><strong>üí° What we're looking for:</strong> Field completeness, data types, real-world applicability, missing attributes, and any other insights from your biomass supply chain experience.</p>
        </div>

        <div class="erd-container" id="erd-container">
            <div class="zoom-controls">
                <button class="zoom-btn" id="zoom-in" title="Zoom In">+</button>
                <button class="zoom-btn" id="zoom-out" title="Zoom Out">‚àí</button>
                <button class="zoom-btn" id="zoom-reset" title="Reset View">‚åÇ</button>
            </div>
            <div class="zoom-info" id="zoom-info">
                Zoom: 100% | üñ±Ô∏è Drag to pan, scroll to zoom
            </div>
            <div class="svg-wrapper" id="svg-wrapper">
                <img src="../drafts/images/boost_integrated_erd_mermaid.svg" alt="BOOST Entity Relationship Diagram" class="erd-svg" id="erd-svg">
                <!-- Clickable overlays for entities -->
                <div class="entity-overlay" data-entity="Organization" data-discussion="90" style="position: absolute; left: 41.8%; top: 10.1%; width: 7.8%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="CertificationScheme" data-discussion="91" style="position: absolute; left: 3.6%; top: 29.1%; width: 7.3%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="Certificate" data-discussion="92" style="position: absolute; left: 14.4%; top: 24.9%; width: 7.3%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="CertificationBody" data-discussion="93" style="position: absolute; left: 29.8%; top: 57.4%; width: 8.1%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="MaterialFeedstock" data-discussion="94" style="position: absolute; left: 94.9%; top: 78.1%; width: 7.3%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="Supplier" data-discussion="95" style="position: absolute; left: 25.1%; top: 28.1%; width: 6.8%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="Customer" data-discussion="96" style="position: absolute; left: 35.2%; top: 30.3%; width: 6.8%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="TransactionConsignment" data-discussion="97" style="position: absolute; left: 83.0%; top: 28.1%; width: 8.9%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="TransactionBatch" data-discussion="98" style="position: absolute; left: 76.7%; top: 54.7%; width: 8.4%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="Claim" data-discussion="99" style="position: absolute; left: 59.4%; top: 83.4%; width: 5.2%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="SaleDeliveryDocument" data-discussion="100" style="position: absolute; left: 89.3%; top: 49.3%; width: 8.9%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="SAR" data-discussion="101" style="position: absolute; left: 82.5%; top: 83.4%; width: 4.7%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="SREG" data-discussion="102" style="position: absolute; left: 70.7%; top: 83.4%; width: 5.2%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="VerificationStatement" data-discussion="103" style="position: absolute; left: 48.3%; top: 29.1%; width: 8.4%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="MassBalanceAccount" data-discussion="104" style="position: absolute; left: 58.8%; top: 26.0%; width: 8.4%; height: 19.4%;"></div>
                <div class="entity-overlay" data-entity="ProductGroup" data-discussion="105" style="position: absolute; left: 70.9%; top: 30.3%; width: 7.8%; height: 19.4%;"></div>
            </div>
        </div>

        <div class="entity-links">
            <a href="https://github.com/carbondirect/BOOST/discussions/90" class="entity-link" target="_blank">
                <strong>Organization</strong><br>
                Legal entities in biomass supply chain
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/91" class="entity-link" target="_blank">
                <strong>CertificationScheme</strong><br>
                Standards (FSC, SBP, RSB, ISO 38200, etc.)
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/92" class="entity-link" target="_blank">
                <strong>Certificate</strong><br>
                Formal certification documents
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/93" class="entity-link" target="_blank">
                <strong>CertificationBody</strong><br>
                Independent third-party certification organizations
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/94" class="entity-link" target="_blank">
                <strong>MaterialFeedstock</strong><br>
                Physical biomass/materials with quantity, type, species data
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/95" class="entity-link" target="_blank">
                <strong>Supplier</strong><br>
                Legal entities providing materials
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/96" class="entity-link" target="_blank">
                <strong>Customer</strong><br>
                Legal entities receiving materials
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/97" class="entity-link" target="_blank">
                <strong>TransactionConsignment</strong><br>
                Material transfers between organizations
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/98" class="entity-link" target="_blank">
                <strong>TransactionBatch</strong><br>
                Specific quantities within transactions
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/99" class="entity-link" target="_blank">
                <strong>Claim</strong><br>
                Certification claims (SBP-compliant, FSC Mix, RSB Global)
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/100" class="entity-link" target="_blank">
                <strong>SaleDeliveryDocument</strong><br>
                Official transfer documentation
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/101" class="entity-link" target="_blank">
                <strong>SAR</strong><br>
                SBP Audit Reports on Energy and Carbon Data
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/102" class="entity-link" target="_blank">
                <strong>SREG</strong><br>
                SBP Reports on Energy and Carbon for Supplied Biomass
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/103" class="entity-link" target="_blank">
                <strong>VerificationStatement</strong><br>
                Third-party verification documents
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/104" class="entity-link" target="_blank">
                <strong>MassBalanceAccount</strong><br>
                Accounting mechanism for certified material tracking
            </a>
            <a href="https://github.com/carbondirect/BOOST/discussions/105" class="entity-link" target="_blank">
                <strong>ProductGroup</strong><br>
                Categorization for chain of custody methods
            </a>
        </div>

        <div class="footer">
            <p>This ERD navigator is part of the BOOST data standard development process.<br>
            Your feedback helps ensure the standard meets real-world biomass chain of custody needs.</p>
            <p><a href="https://github.com/carbondirect/BOOST">üìÇ View full repository</a> | 
            <a href="https://github.com/carbondirect/BOOST/issues/61">üéØ Parent Issue #61</a></p>
        </div>
    </div>

    <script>
        class ERDNavigator {
            constructor() {
                this.scale = 1;
                this.translateX = 0;
                this.translateY = 0;
                this.isDragging = false;
                this.startX = 0;
                this.startY = 0;
                this.container = document.getElementById('erd-container');
                this.svgWrapper = document.getElementById('svg-wrapper');
                this.svgElement = document.getElementById('erd-svg');
                this.zoomInfo = document.getElementById('zoom-info');
                
                this.init();
            }
            
            init() {
                // Zoom controls
                document.getElementById('zoom-in').addEventListener('click', () => this.zoomIn());
                document.getElementById('zoom-out').addEventListener('click', () => this.zoomOut());
                document.getElementById('zoom-reset').addEventListener('click', () => this.resetView());
                
                // Mouse wheel zoom
                this.container.addEventListener('wheel', (e) => this.handleWheel(e));
                
                // Pan functionality
                this.svgWrapper.addEventListener('mousedown', (e) => this.startDrag(e));
                document.addEventListener('mousemove', (e) => this.drag(e));
                document.addEventListener('mouseup', () => this.endDrag());
                
                // Touch support for mobile
                this.svgWrapper.addEventListener('touchstart', (e) => this.startTouch(e));
                this.svgWrapper.addEventListener('touchmove', (e) => this.moveTouch(e));
                this.svgWrapper.addEventListener('touchend', () => this.endDrag());
                
                // Prevent context menu on right click
                this.svgWrapper.addEventListener('contextmenu', (e) => e.preventDefault());
                
                // Entity click handlers
                this.initEntityClickHandlers();
                
                this.updateTransform();
            }
            
            initEntityClickHandlers() {
                const entityOverlays = document.querySelectorAll('.entity-overlay');
                entityOverlays.forEach(overlay => {
                    overlay.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const discussionNumber = overlay.getAttribute('data-discussion');
                        const entityName = overlay.getAttribute('data-entity');
                        const discussionUrl = `https://github.com/carbondirect/BOOST/discussions/${discussionNumber}`;
                        
                        // Add a visual click effect
                        overlay.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            overlay.style.transform = 'scale(1)';
                        }, 150);
                        
                        // Open discussion in new tab
                        window.open(discussionUrl, '_blank');
                    });
                    
                    // Prevent pan when hovering over entity
                    overlay.addEventListener('mousedown', (e) => {
                        e.stopPropagation();
                    });
                });
            }
            
            zoomIn() {
                this.scale = Math.min(this.scale * 1.2, 5);
                this.updateTransform();
            }
            
            zoomOut() {
                this.scale = Math.max(this.scale / 1.2, 0.1);
                this.updateTransform();
            }
            
            resetView() {
                this.scale = 1;
                this.translateX = 0;
                this.translateY = 0;
                this.updateTransform();
            }
            
            handleWheel(e) {
                e.preventDefault();
                const rect = this.container.getBoundingClientRect();
                const centerX = (rect.width / 2 - this.translateX) / this.scale;
                const centerY = (rect.height / 2 - this.translateY) / this.scale;
                
                const scaleFactor = e.deltaY > 0 ? 0.9 : 1.1;
                const newScale = Math.max(0.1, Math.min(5, this.scale * scaleFactor));
                
                this.translateX += (centerX * this.scale - centerX * newScale);
                this.translateY += (centerY * this.scale - centerY * newScale);
                this.scale = newScale;
                
                this.updateTransform();
            }
            
            startDrag(e) {
                this.isDragging = true;
                this.startX = e.clientX - this.translateX;
                this.startY = e.clientY - this.translateY;
                e.preventDefault();
            }
            
            startTouch(e) {
                if (e.touches.length === 1) {
                    this.isDragging = true;
                    this.startX = e.touches[0].clientX - this.translateX;
                    this.startY = e.touches[0].clientY - this.translateY;
                    e.preventDefault();
                }
            }
            
            drag(e) {
                if (!this.isDragging) return;
                
                this.translateX = e.clientX - this.startX;
                this.translateY = e.clientY - this.startY;
                this.updateTransform();
            }
            
            moveTouch(e) {
                if (!this.isDragging || e.touches.length !== 1) return;
                
                this.translateX = e.touches[0].clientX - this.startX;
                this.translateY = e.touches[0].clientY - this.startY;
                this.updateTransform();
                e.preventDefault();
            }
            
            endDrag() {
                this.isDragging = false;
            }
            
            updateTransform() {
                const transform = `translate(${this.translateX}px, ${this.translateY}px) scale(${this.scale})`;
                this.svgWrapper.style.transform = transform;
                
                const zoomPercent = Math.round(this.scale * 100);
                this.zoomInfo.textContent = `Zoom: ${zoomPercent}% | üñ±Ô∏è Drag to pan, scroll to zoom`;
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const navigator = new ERDNavigator();
            
            // Also try to handle SVG loading for potential click handlers
            const svgObject = document.getElementById('erd-svg');
            svgObject.addEventListener('load', function() {
                const svgDoc = svgObject.contentDocument;
                if (svgDoc) {
                    console.log('SVG loaded successfully - ready for potential entity click handlers');
                }
            });
        });
    </script>
</body>
</html>